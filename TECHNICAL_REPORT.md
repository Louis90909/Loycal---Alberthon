# Loycal - Technical Report

## 1. Project Overview
**Loycal** is a modern, AI-powered loyalty and customer engagement platform built specifically for restaurants. The platform acts as a bridge between restaurateurs and their clients, allowing businesses to easily manage loyalty programs, publish flash promotions, and engage customers via an AI Assistant named "Rémi".

The platform handles three distinct user flows:
1. **Loyer (Customers)**: Discover restaurants, book flash offers, check loyalty points, and interact with the AI assistant.
2. **Restaurateurs**: Manage their establishment profile, configure loyalty programs (points, stamps, missions), analyze dashboards, and integrate with their Point of Sale (POS).
3. **Administrators**: Get a global overview of the platform's health and statistics.

---

## 2. Technical Architecture
The Loycal platform adopts a standard decoupling strategy with a distinct Frontend and Backend, communicating via RESTful APIs.

### 2.1 Backend Architecture
- **Framework**: NestJS 10 (Node.js)
- **Language**: TypeScript
- **Database Architecture**: PostgreSQL accessed via Prisma ORM
- **Key Modules**:
  - `AuthModule`: Handles JWT-based authentication and user registrations.
  - `LoyaltyModule`: Manages different program types (Points, Stamps, Missions) and customer point validations.
  - `CampaignsModule`: Allows sending marketing campaigns and managing flash promotions.
  - `AiModule` (Rémi): Integrates the **Google Gemini API** with Retrieval-Augmented Generation (RAG) capabilities to provide context-aware responses to users.
  - `PosModule`: Simulates POS integration for order creation and payment validation.

### 2.2 Frontend Architecture
- **Framework**: React 18
- **Language**: TypeScript
- **Build Tool**: Vite 6.2
- **State Management & Routing**: React components connected via standard React hooks.
- **Styling**: TailwindCSS (or custom utility classes) with a highly responsive, component-driven design system.
- **Data Visualization**: Recharts for restaurateur analytics dashboards.
- **Client Architecture**: The frontend is split into domains matching the roles: `src/loyer/`, `src/restaurateur/`, `src/admin/`, and a `src/shared/` folder for universal components.

---

## 3. Key Design Decisions & Features

### 3.1 Google Gemini AI (Rémi)
The AI assistant is deeply integrated into the Loycal ecosystem. Instead of a simple chatbot, Rémi uses context injection (RAG). When a customer asks a question, Rémi is aware of the customer's current points, favorite restaurants, and ongoing promotions, providing hyper-personalized recommendations.

### 3.2 Dynamic Loyalty Systems
Unlike standard applications that only offer "points", Loycal's database schema allows restaurateurs to select from multiple program types:
- **Spending Ratio**: E.g., 1€ = 10 points.
- **Stamps**: Buy 9 coffees, get the 10th free.
- **Missions**: Gamified objectives to unlock specific rewards.

### 3.3 Security & Migration Tracking
- **Authentication**: Secured via JWT tokens with strict Role-Based Access Control (RBAC).
- **Recent Migrations**: The project recently underwent a structural migration, properly separating the monolithic Next/React code into a dedicated NestJS backend and a Vite frontend. Sensitive credentials (like Firebase keys and the Gemini API key) were scrubbed from the repository history using `git filter-branch` to ensure complete security.

---

## 4. Current Status & Next Steps
As of the latest development cycle, the foundation of the platform is **Production-Ready**. 

**Upcoming Priorities:**
1. **RAG Improvements**: Enhancing the vectorization of data so the Gemini AI can ingest menus and PDFs directly from the restaurateur.
2. **POS Webhooks**: Implementing real webhooks to synchronize in real-time with physical POS systems instead of simulated endpoints.
3. **User Sync**: Finalizing the cleanup of orphaned users between Firebase Auth and the Postgres database.

---
*Generated by Loycal Engineering Team.*
